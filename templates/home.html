<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APARTMENTS</title>
    <link rel="stylesheet" href="static/estilo.css">
</head>
<body>
    <div class="container">
        <form action="{{ url_for('predict')}}" method="post" onsubmit="return validateForm(event)">
            <h1>Averigua el precio de tu futuro apartamento</h1>

            <!-- Área -->
            <div class="form-group">
                <label class="form-label">Área (m²)</label>
                <input type="number" name="area" id="area" class="input-field" placeholder="1000" 
                       value="{{ request.form.get('area', '') }}" required>
            </div>

            <!-- Habitaciones -->
            <div class="form-group">
                <label class="form-label">Habitaciones</label>
                <input type="hidden" name="habitaciones" id="habitaciones_value" 
                       value="{{ request.form.get('habitaciones', '') }}">
                <div class="button-group">
                    <button type="button" class="option-button" data-value="Habitaciones_1.0" 
                            onclick="selectOption(this, 'habitaciones_value')">1</button>
                    <button type="button" class="option-button" data-value="Habitaciones_2.0" 
                            onclick="selectOption(this, 'habitaciones_value')">2</button>
                    <button type="button" class="option-button" data-value="Habitaciones_3.0" 
                            onclick="selectOption(this, 'habitaciones_value')">3</button>
                    <button type="button" class="option-button" data-value="Habitaciones_4.0" 
                            onclick="selectOption(this, 'habitaciones_value')">4</button>
                    <button type="button" class="option-button" data-value="Habitaciones_5.0" 
                            onclick="selectOption(this, 'habitaciones_value')">5</button>
                </div>
            </div>

            <!-- Baños -->
            <div class="form-group">
                <label class="form-label">Baños</label>
                <input type="hidden" name="bath" id="bath_value" 
                       value="{{ request.form.get('bath', '') }}">
                <div class="button-group">
                    <button type="button" class="option-button bath-btn" data-value="Baños_1.0" 
                            onclick="selectOption(this, 'bath_value')">1</button>
                    <button type="button" class="option-button bath-btn" data-value="Baños_2.0" 
                            onclick="selectOption(this, 'bath_value')">2</button>
                    <button type="button" class="option-button bath-btn" data-value="Baños_3.0" 
                            onclick="selectOption(this, 'bath_value')">3</button>
                    <button type="button" class="option-button bath-btn" data-value="Baños_4.0" 
                            onclick="selectOption(this, 'bath_value')">4</button>
                    <button type="button" class="option-button bath-btn" data-value="Baños_5.0" 
                            onclick="selectOption(this, 'bath_value')">5</button>
                </div>
            </div>

            <!-- Antigüedad -->
            <div class="form-group">
                <label class="form-label">Antigüedad</label>
                <input type="hidden" name="edad" id="edad_value" 
                       value="{{ request.form.get('edad', '') }}">
                <div class="age-buttons">
                    <button type="button" class="age-button" data-value="Antigüedad_menor-a-1-anio" 
                            onclick="selectOption(this, 'edad_value')">< 1 año</button>
                    <button type="button" class="age-button" data-value="Antigüedad_de-1-a-8-anios" 
                            onclick="selectOption(this, 'edad_value')">1-8 años</button>
                    <button type="button" class="age-button" data-value="Antigüedad_de-9-a-15-anios" 
                            onclick="selectOption(this, 'edad_value')">9-15 años</button>
                    <button type="button" class="age-button" data-value="Antigüedad_de-16-a-30-anios" 
                            onclick="selectOption(this, 'edad_value')">16-30 años</button>
                    <button type="button" class="age-button" data-value="Antigüedad_mas-de-30-anios" 
                            onclick="selectOption(this, 'edad_value')">> 30 años</button>
                </div>
            </div>

            <!-- Estrato -->
            <div class="form-group">
                <label class="form-label">Estrato</label>
                <input type="hidden" name="estrato" id="estrato_value" 
                       value="{{ request.form.get('estrato', '') }}">
                <div class="button-group">
                    <button type="button" class="option-button estrato-btn" data-value="Estrato_2.0" 
                            onclick="selectOption(this, 'estrato_value')">2</button>
                    <button type="button" class="option-button estrato-btn" data-value="Estrato_3.0" 
                            onclick="selectOption(this, 'estrato_value')">3</button>
                    <button type="button" class="option-button estrato-btn" data-value="Estrato_4.0" 
                            onclick="selectOption(this, 'estrato_value')">4</button>
                    <button type="button" class="option-button estrato-btn" data-value="Estrato_5.0" 
                            onclick="selectOption(this, 'estrato_value')">5</button>
                    <button type="button" class="option-button estrato-btn" data-value="Estrato_6.0" 
                            onclick="selectOption(this, 'estrato_value')">6</button>
                </div>
            </div>

            <!-- Parqueaderos -->
            <div class="form-group parking-group">
                <label class="form-label">Parqueaderos</label>
                <input type="hidden" name="parqueaderos" id="parqueaderos_value" 
                       value="{{ request.form.get('parqueaderos', '') }}">
                <div class="button-group">
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_0.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">0</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_1.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">1</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_2.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">2</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_3.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">3</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_4.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">4</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_5.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">5</button>
                    <button type="button" class="option-button parking-btn" data-value="Parqueaderos_6.0" 
                            onclick="selectOption(this, 'parqueaderos_value')">6</button>
                </div>
            </div>

            <!-- Localidad -->
            <div class="form-group">
                <label class="form-label">Localidad</label>
                <select name="localidad" id="localidad" class="select-field" required>
                    <option value="">Selecciona una localidad</option>
                    <option value="LOCALIDAD_BARRIOS UNIDOS" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_BARRIOS UNIDOS' }}>BARRIOS UNIDOS</option>
                    <option value="LOCALIDAD_BOSA" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_BOSA' }}>BOSA</option>
                    <option value="LOCALIDAD_CHAPINERO" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_CHAPINERO' }}>CHAPINERO</option>
                    <option value="LOCALIDAD_CIUDAD BOLIVAR" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_CIUDAD BOLIVAR' }}>CIUDAD BOLIVAR</option>
                    <option value="LOCALIDAD_ENGATIVA" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_ENGATIVA' }}>ENGATIVA</option>
                    <option value="LOCALIDAD_FONTIBON" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_FONTIBON' }}>FONTIBON</option>
                    <option value="LOCALIDAD_KENNEDY" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_KENNEDY' }}>KENNEDY</option>
                    <option value="LOCALIDAD_PUENTE ARANDA" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_PUENTE ARANDA' }}>PUENTE ARANDA</option>
                    <option value="LOCALIDAD_SANTAFE" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_SANTAFE' }}>SANTAFE</option>
                    <option value="LOCALIDAD_SUBA" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_SUBA' }}>SUBA</option>
                    <option value="LOCALIDAD_TEUSAQUILLO" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_TEUSAQUILLO' }}>TEUSAQUILLO</option>
                    <option value="LOCALIDAD_USAQUEN" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_USAQUEN' }}>USAQUEN</option>
                    <option value="LOCALIDAD_USME" {{ 'selected' if request.form.get('localidad') == 'LOCALIDAD_USME' }}>USME</option>
                </select>
            </div>

            <button type="submit" class="predict-button">Predecir Precio</button>

            <div class="result" id="result">
                {{prediction_text if prediction_text else 'Selecciona todas las opciones y presiona "Predecir Precio" para ver el resultado'}}
            </div>
        </form>
    </div>

    <script>
        // Función para manejar la selección de botones
        function selectOption(button, hiddenInputId) {
            // Remover clase active de todos los botones del mismo grupo
            const buttons = button.parentElement.querySelectorAll('.option-button, .age-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Agregar clase active al botón seleccionado
            button.classList.add('active');
            
            // Actualizar el valor del input oculto
            document.getElementById(hiddenInputId).value = button.getAttribute('data-value');
        }

        // Función para restaurar las selecciones al cargar la página
        function restoreSelections() {
            // Lista de todos los campos con sus IDs
            const fields = [
                'habitaciones_value',
                'bath_value', 
                'edad_value',
                'estrato_value',
                'parqueaderos_value'
            ];

            fields.forEach(fieldId => {
                const hiddenInput = document.getElementById(fieldId);
                const selectedValue = hiddenInput.value;
                
                if (selectedValue) {
                    // Buscar el botón correspondiente
                    const button = document.querySelector(`[data-value="${selectedValue}"]`);
                    if (button) {
                        button.classList.add('active');
                    }
                }
            });
        }

        // Función para validar el formulario antes de enviarlo
        function validateForm(event) {
            const area = document.getElementById('area').value;
            const habitaciones = document.getElementById('habitaciones_value').value;
            const bath = document.getElementById('bath_value').value;
            const edad = document.getElementById('edad_value').value;
            const estrato = document.getElementById('estrato_value').value;
            const parqueaderos = document.getElementById('parqueaderos_value').value;
            const localidad = document.getElementById('localidad').value;
            
            // Validar que todos los campos estén llenos
            if (!area || !habitaciones || !bath || !edad || !estrato || !parqueaderos || !localidad) {
                document.getElementById('result').innerHTML = '⚠️ Por favor, completa todos los campos';
                event.preventDefault();
                return false;
            }
            
            // Si todo está completo, permitir el envío del formulario
            return true;
        }

        // Ejecutar al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('result').style.display = 'flex';
            restoreSelections(); // Restaurar las selecciones después de enviar el formulario
        });
    </script>
</body>
</html>